package itt.t00154755.mouseserver;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;

public class ServerCommsThread implements Runnable
{

	private final String TAG = "Server Communication Thread";
	private InputStream inStream = null;


	public ServerCommsThread( InputStream inStream )
	{
		System.out.println(TAG + "...constructor");
		this.inStream = inStream;
	}


	@Override
	public void run()
	{
		// keep reading
		while ( true )
		{
			System.out.println(TAG + " in the run() ");
			try
			{
				BufferedReader r = new BufferedReader(new InputStreamReader(inStream));

				String line;
				while ((line = r.readLine()) != null) {
					if ( line.length() == 5 )
					{
						System.out.println(TAG + "\npassing data to the robot");
						// start a new Thread that will handle incoming traffic
						Thread robotThread = new Thread(new CursorRobot( line ));
						robotThread.start();
					}
				}

					
				}

			}
			catch ( IOException e )
			{
				// print the error stack
				e.printStackTrace();
				e.getCause();
				
				
				try
				{
					inStream.close();
				}
				catch ( IOException e1 )
				{
					System.out.println("closing the input stream");
				}
				System.out.println(TAG + "shutting down the server 2");
				System.exit(-1);
			}
		}
	}

}// end of Class
