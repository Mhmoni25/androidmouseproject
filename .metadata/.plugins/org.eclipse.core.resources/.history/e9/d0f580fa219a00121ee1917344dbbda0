package itt.t00154755.mouseserver;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;                  

import javax.bluetooth.BluetoothStateException;
import javax.bluetooth.RemoteDevice;
import javax.microedition.io.StreamConnection;

public class ServerCommsThread extends Thread 
{
	private final String TAG = "Server Communication Thread";
	CursorRobot cr;
	InputStream dataIn;
	AppServer appServer;

	public ServerCommsThread ( StreamConnection streamConnection )
	{
		RemoteDevice reDevice;
		try {
			reDevice = RemoteDevice.getRemoteDevice(streamConnection);
			
			System.out.println(TAG + "...Server is Connected to: \n" 
					+ reDevice.getBluetoothAddress()
					+ "\n" + reDevice.getFriendlyName(true));
			
		} catch (IOException e) {
			// print the error stack
			e.printStackTrace();
			e.getCause();
			System.exit(-1);
		};
	}
	
	
	
	
	public void run() 
	{
		BufferedReader buffIn = new BufferedReader(new InputStreamReader(dataIn));
		try 
		{
			while (true)
			{
				String acceloData = buffIn.readLine();
				
				cr.sendToRobot(acceloData);
			}
		}
		catch (Exception e) 
		{
			// print the error stack
			e.printStackTrace();
			e.getCause();
			System.exit(-1);

		} 
		finally 
		{
			try 
			{
				if (dataIn != null)
				{
					dataIn.close();
				}
			} 
			catch (IOException e) 
			{
				// print the error stack
				e.printStackTrace();
				e.getCause();
				System.exit(-1);
			}
		}
	}
}// end of Class